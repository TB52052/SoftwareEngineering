<!DOCTYPE html>
<html>
<head>
    <%- include('partials/global-head') %>
    <%- include('partials/main-page-head') %>
    <link rel="stylesheet" href="/styles/side-bar.css">
    <link rel="stylesheet" href="/styles/tasks.css">
    <title>Study Planner - Tasks</title>
</head>
<body>
    <div class="wrapper">
        <%- include('partials/side-bar') %>
        <div class="container">
            <div class="content">
                <!-- Add Task Section -->
                <div class="add-task-section form-page"> 
                    <h2 class="form-title">Add New Task</h2>
                    <form class="form-form" id="addTaskForm" action="/tasks" method="POST">
                        <div class="input-group">
                            <label for="taskName">Task Name:</label>
                            <input type="text" id="taskName" name="taskName" required>
                        </div>
                        <div class="input-group">
                            <label for="module">Module:</label>
                            <select id="module" name="module" required>
                                <% modules.forEach(function(module) { %>
                                    <option value="<%= module.moduleId %>"><%= module.moduleName %></option>
                                <% }); %>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="assessment">Assessment:</label>
                            <select id="assessment" name="assessment" required>
                                <% assessments.forEach(function(assessment) { %>
                                    <option value="<%= assessment.assessmentId %>"><%= assessment.assessmentName %></option>
                                <% }); %>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="timeSpent">Time Spent (hours):</label>
                            <input type="number" id="timeSpent" name="timeSpent" required>
                        </div>
                        <div class="input-group">
                            <label for="taskRequirement">Task Requirement:</label>
                            <select id="taskRequirement" name="taskRequirement" required>
                                <% taskTypes.forEach(function(taskType) { %>
                                    <option value="<%= taskType.TypeID %>"><%= taskType.TypeName %></option>
                                <% }); %>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="progressMeasurement">Progress Measurement:</label>
                            <select id="progressMeasurement" name="progressMeasurement" required>
                                <% taskTypes.forEach(function(taskType) { %>
                                    <option value="<%= taskType.TypeID %>"><%= taskType.ProgressMeasurement %></option>
                                <% }); %>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="taskDeadline">Task Deadline:</label>
                            <input type="date" id="taskDeadline" name="taskDeadline" required>
                        </div>
                        <input type="hidden" id="userId" name="userId" value="<%= userId %>">  
                        <div class="form-button">
                            <button class="input-button" type="submit">Add Task</button>
                        </div>
                    </form>
                </div>

                <!-- Existing Tasks Section -->
                <div class="tasks-section">
                    <h2>Existing Tasks</h2>
                    <div class="task-list">
                        <% tasks.forEach(function(task) { %>
                            <div class="task-item">
                                <h3><%= task.TaskName %></h3>
                                <p>Module: <%= task.ModuleName %></p>
                                <p>Assignment: <%= task.AssessmentName %></p>
                                <p>Time Spent (hours): <%= task.TimeSpent %></p>
                                <p>Type: <%= task.TypeName %></p>
                                <p>Progress Measurement: <%= task.ProgressMeasurement %></p>
                                <p class="task-deadline">Deadline: <%= task.TaskDate %></p>
                            </div>
                        <% }); %>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <%- include('partials/error-box') %>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('addTaskForm').addEventListener('submit', async function(event) {
                event.preventDefault(); // Prevent default form submission

                const formData = new FormData(this); // Get form data

                const response = await fetch('/tasks', {
                    method: 'POST',
                    body: formData
                });
                if (response.ok) {
                    // Task added successfully, maybe show a success message
                } else {
                    // Handle error
                    console.error('Failed to add task');
                }
            });
        });
    </script>
</body>
</html>